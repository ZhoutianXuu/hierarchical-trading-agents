# Multi-Agent System Architecture Diagram

```
╔═══════════════════════════════════════════════════════════════════════════╗
║                   HIERARCHICAL MULTI-AGENT TRADING SYSTEM                 ║
╚═══════════════════════════════════════════════════════════════════════════╝

┌───────────────────────────────────────────────────────────────────────────┐
│                         LAYER 3: RAG KNOWLEDGE BASE                       │
│  ┌─────────────────────────────────────────────────────────────────────┐  │
│  │  • Financial Documents        • Company Filings                     │  │
│  │  • News Articles              • Earnings Reports                    │  │
│  │  • Market Research            • Technical Analysis Reports          │  │
│  │                                                                     │  │
│  │  Vector Store (FAISS)  →  Retrieval Pipeline  →  Context Injection  │  │
│  └─────────────────────────────────────────────────────────────────────┘  │
└───────────────────────────────────────────────────────────────────────────┘
                                      ↓
                            Retrieved Context
                                      ↓
┌───────────────────────────────────────────────────────────────────────────┐
│                     LAYER 1: SPECIALIZED AGENT LAYER                      │
│                                                                           │
│   ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐           │
│   │  FUNDAMENTAL    │  │   SENTIMENT     │  │   TECHNICAL     │           │
│   │     AGENT       │  │     AGENT       │  │     AGENT       │           │
│   ├─────────────────┤  ├─────────────────┤  ├─────────────────┤           │
│   │ • P/E Ratio     │  │ • News Analysis │  │ • OHLC Data     │           │
│   │ • P/B Ratio     │  │ • Sentiment     │  │ • Volume        │           │
│   │ • Financials    │  │   Scores        │  │ • Indicators    │           │
│   │ • Earnings      │  │ • Market Mood   │  │ • Patterns      │           │
│   └─────────────────┘  └─────────────────┘  └─────────────────┘           │
│            ↓                    ↓                     ↓                   │
│   ┌────────────────────────────────────────────────────────┐              │
│   │                 RISK MANAGEMENT AGENT                  │              │
│   ├────────────────────────────────────────────────────────┤              │
│   │ • Portfolio Risk    • Volatility     • Stop Loss       │              │
│   │ • Position Sizing   • Correlation    • Max Drawdown    │              │
│   └────────────────────────────────────────────────────────┘              │
│                                                                           │
│   Each Agent: Tuned LLM (LoRA) with specialized prompts                   │
└───────────────────────────────────────────────────────────────────────────┘
                                      ↓
                          Agent Outputs (AgentOutput objects)
                                      ↓
┌───────────────────────────────────────────────────────────────────────────┐
│                 LAYER 2: HIERARCHICAL COORDINATION LAYER                  │
│                                                                           │
│   ┌──────────────────────────────────────────────────────────────────┐    │
│   │                         REVIEWER AGENT                           │    │
│   │                  (Chain-of-Thought Synthesis)                    │    │
│   ├──────────────────────────────────────────────────────────────────┤    │
│   │  Input: All Agent Outputs                                        │    │
│   │  Process:                                                        │    │
│   │    1. Identify consensus signals                                 │    │
│   │    2. Detect contradictions                                      │    │
│   │    3. Weigh agent confidence                                     │    │
│   │    4. Synthesize coherent narrative                              │    │
│   │  Output: Synthesized Analysis                                    │    │
│   └──────────────────────────────────────────────────────────────────┘    │
│                                ↓                                          │
│   ┌──────────────────────────────────────────────────────────────────┐    │
│   │                         DECISION AGENT                           │    │
│   │                  (Final Decision Generation)                     │    │
│   ├──────────────────────────────────────────────────────────────────┤    │
│   │  Input: Synthesized Analysis + Agent Outputs                     │    │
│   │  Process:                                                        │    │
│   │    1. Integrate insights                                         │    │
│   │    2. Apply trading rules                                        │    │
│   │    3. Generate confidence score                                  │    │
│   │    4. Produce rationale                                          │    │
│   │  Output: Trading Decision (BUY/SELL/HOLD)                        │    │
│   └──────────────────────────────────────────────────────────────────┘    │
└───────────────────────────────────────────────────────────────────────────┘
                                      ↓
                              Trading Decision
                                      ↓
                    ┌──────────────────────────────────┐
                    │   ACTION: BUY/SELL/HOLD          │
                    │   CONFIDENCE: 0.0 - 1.0          │
                    │   RATIONALE: Detailed reasoning  │
                    │   RISK: Assessment & factors     │
                    └──────────────────────────────────┘


═══════════════════════════════════════════════════════════════════════════
                              DATA FLOW EXAMPLE
═══════════════════════════════════════════════════════════════════════════

INPUT: Market Data for AAPL on 2023-06-15
├─ OHLC: Open=$175.50, High=$178.20, Low=$174.80, Close=$177.30
├─ Volume: 52,000,000
├─ Valuation: P/E=28.5, P/B=45.2
├─ News: ["Apple announces AI features...", "Strong iPhone sales..."]
└─ Fundamentals: Revenue=$394.3B, EPS=$6.13

                                ↓ RAG Retrieval

RETRIEVED CONTEXT:
├─ "AAPL stock has shown strong performance in 2023..."
├─ "Federal Reserve interest rate policies affect tech stocks..."
└─ "Consumer sentiment for Apple products remains strong..."

                                ↓ Agent Analysis

AGENT OUTPUTS:
├─ Fundamental: "UNDERVALUED, Strong financials" (Confidence: 0.75)
├─ Sentiment: "POSITIVE_SENTIMENT, Bullish news" (Confidence: 0.80)
├─ Technical: "BREAKOUT, Strong momentum" (Confidence: 0.70)
└─ Risk: "MEDIUM_RISK, Manageable volatility" (Confidence: 0.85)

                                ↓ Synthesis

REVIEWER SYNTHESIS:
"Strong consensus across all agents. Fundamental analysis indicates 
undervaluation with robust financial metrics. Sentiment is overwhelmingly 
positive with recent AI announcements. Technical indicators show bullish 
momentum. Risk is moderate and manageable. High confidence in positive outlook."

                                ↓ Decision

FINAL DECISION:
├─ ACTION: BUY
├─ CONFIDENCE: 0.78
├─ RATIONALE: "All four specialized agents align on bullish signals..."
└─ RISK: Medium, Position size: 10% of capital


═══════════════════════════════════════════════════════════════════════════
                           EVALUATION PIPELINE
═══════════════════════════════════════════════════════════════════════════

┌─────────────────────────────────────────────────────────────────────────┐
│  METRICS TRACKING                                                       │
│  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐          │
│  │   ACCURACY      │  │   COHERENCE     │  │   EFFICIENCY    │          │
│  ├─────────────────┤  ├─────────────────┤  ├─────────────────┤          │
│  │ • Precision     │  │ • Consensus     │  │ • Latency       │          │
│  │ • Recall        │  │   Rate          │  │ • Token Usage   │          │
│  │ • F1 Score      │  │ • Contradiction │  │ • Throughput    │          │
│  │ • Accuracy      │  │   Detection     │  │ • Memory        │          │
│  └─────────────────┘  └─────────────────┘  └─────────────────┘          │
│                                                                         │
│  ┌─────────────────────────────────────────────────────────────────┐    │
│  │              FINANCIAL PERFORMANCE METRICS                      │    │
│  ├─────────────────────────────────────────────────────────────────┤    │
│  │  • Total Return        • Sharpe Ratio      • Max Drawdown       │    │
│  │  • Win Rate            • Trade Count       • Profit Factor      │    │
│  └─────────────────────────────────────────────────────────────────┘    │
└─────────────────────────────────────────────────────────────────────────┘

                                ↓ Analysis

┌─────────────────────────────────────────────────────────────────────────┐
│  EVALUATION REPORT                                                      │
│  ✓ Accuracy: 72% correct predictions                                    │
│  ✓ Consensus: 85% agent agreement                                       │
│  ✓ Latency: 30s average per decision                                    │
│  ✓ Return: 15.2% vs 12.1% benchmark                                     │
└─────────────────────────────────────────────────────────────────────────┘


═══════════════════════════════════════════════════════════════════════════
                         COMPARISON: MODULAR VS MONOLITHIC
═══════════════════════════════════════════════════════════════════════════

MODULAR (PROPOSED)                    MONOLITHIC (BASELINE)
┌──────────────────────┐              ┌──────────────────────┐
│ 4 Specialized Agents │              │   Single LLM Agent   │
│   + Coordination     │              │   All-in-one Prompt  │
├──────────────────────┤              ├──────────────────────┤
│ ✓ High Interpretability             │ ✗ Black-box reasoning
│ ✓ Modular updates    │              │ ✗ Rigid architecture │
│ ✓ Task specialization│              │ ✗ Generic prompts    │
│ ✓ Transparent CoT    │              │ ✗ Limited traceability
│ ✓ Lower latency*     │              │ ✓ Simple deployment  │
│ ✗ More complex       │              │ ✓ Easy to implement  │
└──────────────────────┘              └──────────────────────┘
* With parallelization

RESEARCH GOAL: Demonstrate modular advantages through empirical evaluation


═══════════════════════════════════════════════════════════════════════════
                              TECHNOLOGY STACK
═══════════════════════════════════════════════════════════════════════════

┌─────────────────────────────────────────────────────────────────────────┐
│  LLM FRAMEWORK                                                          │
│  • PyTorch              • Transformers        • Accelerate              │
│  • bitsandbytes (8-bit quantization)                                    │
│  • PEFT (LoRA adapters for specialization)                              │
└─────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────┐
│  RAG PIPELINE                                                           │
│  • LangChain            • FAISS Vector Store  • Sentence Transformers   │
│  • Text Splitters       • Embeddings          • Retrieval               │
└─────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────┐
│  DATA SOURCES                                                           │
│  • Yahoo Finance (yfinance)                                             │
│  • Alpha Vantage (optional)                                             │
│  • NewsAPI (optional)                                                   │
└─────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────┐
│  EVALUATION & VISUALIZATION                                             │
│  • pandas/numpy         • matplotlib/seaborn  • Custom metrics          │
└─────────────────────────────────────────────────────────────────────────┘

```

## Key Insights from Architecture

### 1. Separation of Concerns
Each agent focuses on one aspect of analysis, enabling:
- Specialized fine-tuning
- Independent updates
- Clear reasoning traces

### 2. Hierarchical Coordination
Two-stage decision process:
- Stage 1: Parallel specialized analysis
- Stage 2: Synthesis and decision

### 3. Dynamic Knowledge Integration
RAG enables:
- Real-time information
- Context-aware decisions
- Adaptive to market changes

### 4. Comprehensive Evaluation
Multi-dimensional assessment:
- Prediction accuracy
- Reasoning coherence
- Computational efficiency
- Financial performance
